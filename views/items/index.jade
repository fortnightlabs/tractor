header
  table.hour.toolbar
    tbody: tr
      th.project
      th.checkbox: input( type='checkbox' )
      th
        select#projects
          option( disabled=true ) assign to
          - each project in projects
            option( value=project.id )= project.name
          option( disabled=true )
          option( value='' ) unassign
        button#destroy delete
      th( colspan=3 ): form#filter
        input( type='date', name='date', value=req.param('date') )
        input( type='search', name='query', value=req.param('query'), placeholder='search' )
        input( type='submit', value='go' )

    tfoot
      th &nbsp;

ul.items Loading
  //- hour-view (li)

template( id='hour-view' ):
  table.hour
    thead
      tr
        th.project project
        th.checkbox: input( type='checkbox' )
        th.hour= strftime('%l %p', hour.hour)
        th.duration duration
        th.app app
        th.title title
    //- group-view (tbody)
      //- item-view (tr)
    //- totals-view (tfoot)

template( id='item-view' ):
  // tr is removed by backbone
  tr
    td.project
      - if (item.projectId)
        = projects.get(item.projectId).get('name')
    td: input( type='checkbox', checked=item.selected )
    td!= strftime('%l:<b>%M:%S</b>', item.start)
    td.duration= toDurationString(item.duration)
    - if (item.app)
      td= item.app
      td
        - if (info = item.info)
          div.title
            - if (info.title)
              = info.title
            - else if (info.subject)
              = info.subject
              = ' (' + info.sender + ')'
    - else
      td.unassigned( colspan=2 ) Unassigned

template( id='group-view' ):
  tr.summary
    td.project
      = projects.get(group.get('projectId')).get('name')
      = ' (' + group.collection.length + ')'
    td: input( type='checkbox' )
    td
      != strftime('%l:<b>%M:%S</b>', group.get('start'))
      - if (group.collection.length > 1)
        != strftime(' - %l:<b>%M:%S</b>', group.get('end'))
    td.duration= toDurationString(group.get('duration'))
    td( colspan=2 )= _.keys(group.get('totals').apps).join(', ')

template( id='totals-view' ):
  tr: td.totals( colspan=6 )
    = totals.length
    |  items:
    dl.projects
      - each duration, projectId in totals.projects
        - if (project = projects.get(projectId))
          dt= project.get('name')
          dd
            = toDurationString(duration)
            - if (project.get('rate'))
              = ' ($' + (project.get('rate')*duration/3600).toFixed(2) + ')'
      - if (totals.projects.unassigned)
        dt unassigned
        dd= toDurationString(totals.projects.unassigned)
